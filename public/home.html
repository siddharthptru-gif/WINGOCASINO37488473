<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Wingo Casino</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            min-height: 100vh;
            color: white;
        }
        .sidebar {
            background: rgba(0, 0, 0, 0.8);
            height: 100vh;
            position: fixed;
            width: 250px;
            border-right: 1px solid rgba(0, 255, 255, 0.3);
        }
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        .nav-link {
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s;
        }
        .nav-link:hover, .nav-link.active {
            color: #00ffff;
            background: rgba(0, 255, 255, 0.1);
        }
        .card {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .balance-card {
            background: linear-gradient(45deg, #00ffff, #0080ff);
            color: black;
            border: none;
        }
        .game-card {
            cursor: pointer;
            transition: transform 0.3s;
        }
        .game-card:hover {
            transform: translateY(-5px);
        }
        .countdown {
            font-size: 2rem;
            font-weight: bold;
            color: #00ffff;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="p-3">
            <h3 class="text-center">üéÆ Wingo</h3>
            <hr class="text-info">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link active" href="/home">
                        <i class="fas fa-home me-2"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/game-wingo">
                        <i class="fas fa-dice me-2"></i>Wingo Game
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/wallet">
                        <i class="fas fa-wallet me-2"></i>Wallet
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/history">
                        <i class="fas fa-history me-2"></i>History
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/profile">
                        <i class="fas fa-user me-2"></i>Profile
                    </a>
                </li>
                <li class="nav-item mt-3">
                    <a class="nav-link text-danger" href="#" id="logoutBtn">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="main-content">
        <div class="container-fluid">
            <div class="row mb-4">
                <div class="col-md-12">
                    <h1>Welcome, <span id="username">User</span>!</h1>
                    <p>Ready to play? Check out the latest game results and place your bets!</p>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card balance-card">
                        <div class="card-body text-center">
                            <h5>Wallet Balance</h5>
                            <h2 id="balance">‚Çπ0.00</h2>
                            <button class="btn btn-dark mt-2" onclick="window.location.href='/wallet'">
                                <i class="fas fa-plus"></i> Add Money
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5>Next Game</h5>
                            <div class="countdown" id="countdown">60s</div>
                            <p class="text-muted">Time remaining</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5>Current Result</h5>
                            <div id="currentResult">
                                <span class="badge bg-secondary">Waiting...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h4><i class="fas fa-gamepad me-2"></i>Available Games</h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <div class="card game-card" onclick="window.location.href='/game-wingo'">
                                        <div class="card-body text-center">
                                            <div class="display-4 text-info">üé≤</div>
                                            <h5 class="mt-3">Wingo 1-Minute</h5>
                                            <p class="text-muted">Fast-paced 60-second rounds</p>
                                            <span class="badge bg-success">Live Now</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card game-card">
                                        <div class="card-body text-center">
                                            <div class="display-4 text-warning">üé∞</div>
                                            <h5 class="mt-3">Coming Soon</h5>
                                            <p class="text-muted">More games coming soon</p>
                                            <span class="badge bg-secondary">Soon</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card game-card">
                                        <div class="card-body text-center">
                                            <div class="display-4 text-danger">üÉè</div>
                                            <h5 class="mt-3">Coming Soon</h5>
                                            <p class="text-muted">More games coming soon</p>
                                            <span class="badge bg-secondary">Soon</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h4><i class="fas fa-history me-2"></i>Recent Results</h4>
                        </div>
                        <div class="card-body">
                            <div id="recentResults" class="text-center">
                                <p class="text-muted">Loading recent results...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        const token = localStorage.getItem('access_token');
        const user = JSON.parse(localStorage.getItem('user') || '{}');

        if (!token || !user.id) {
            window.location.href = '/login';
        }

        // Set user info
        document.getElementById('username').textContent = user.username || 'User';

        // Load user data
        async function loadUserData() {
            try {
                const response = await fetch('/api/user/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('balance').textContent = `‚Çπ${data.wallet.balance.toFixed(2)}`;
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Load recent results
        async function loadRecentResults() {
            try {
                const response = await fetch('/api/game/history?limit=10');
                if (response.ok) {
                    const data = await response.json();
                    const resultsDiv = document.getElementById('recentResults');
                    
                    if (data.results.length > 0) {
                        let html = '<div class="d-flex justify-content-center flex-wrap">';
                        data.results.forEach(result => {
                            const colorClass = getColorClass(result.result);
                            html += `<span class="badge ${colorClass} me-2 mb-2" style="font-size: 1.2rem; padding: 10px 15px;">${result.result}</span>`;
                        });
                        html += '</div>';
                        resultsDiv.innerHTML = html;
                    } else {
                        resultsDiv.innerHTML = '<p class="text-muted">No results available yet</p>';
                    }
                }
            } catch (error) {
                console.error('Error loading results:', error);
            }
        }

        // Get color class for result
        function getColorClass(result) {
            const num = parseInt(result);
            if (num === 0 || num === 5) return 'bg-purple';
            if ([1,3,7,9].includes(num)) return 'bg-success';
            if ([2,4,6,8].includes(num)) return 'bg-danger';
            return 'bg-secondary';
        }

        // Add custom CSS for purple color
        const style = document.createElement('style');
        style.textContent = `
            .bg-purple { background-color: #800080 !important; }
        `;
        document.head.appendChild(style);

        // Countdown timer
        function updateCountdown() {
            const now = new Date();
            const seconds = now.getSeconds();
            const remaining = 60 - seconds;
            document.getElementById('countdown').textContent = `${remaining}s`;
            
            // Update current result when new round starts
            if (seconds === 0) {
                loadRecentResults();
            }
        }

        // Logout function
        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            localStorage.removeItem('user');
            window.location.href = '/login';
        });

        // Initialize
        loadUserData();
        loadRecentResults();
        updateCountdown();
        setInterval(updateCountdown, 1000);
        setInterval(loadUserData, 30000); // Refresh balance every 30 seconds
    </script>
</body>
</html>