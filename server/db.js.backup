// Use PostgreSQL in production, SQLite in development
const isProduction = process.env.NODE_ENV === 'production';
const dbModule = isProduction ? require('./db-postgres') : require('./db-sqlite');
require('dotenv').config();

// Use SQLite for persistent storage
console.log('üéÆ Using SQLite database for persistent storage');

// Test database connection
async function testConnection() {
    try {
        // Test SQLite connection
        await sqliteDB.query('SELECT 1');
        console.log('‚úÖ SQLite database connected successfully');
        return true;
    } catch (error) {
        console.error('‚ùå SQLite connection failed:', error.message);
        return false;
    }
}

// Close all connections
async function close() {
    try {
        await sqliteDB.close();
        console.log('üîí SQLite database closed');
    } catch (error) {
        console.error('Error closing SQLite database:', error);
    }
}

// Execute query with error handling
async function query(sql, params = []) {
    try {
        const rows = await sqliteDB.query(sql, params);
        return rows;
    } catch (error) {
        console.error('Database query error:', error);
        throw error;
    }
}

// Execute multiple queries in transaction
async function transaction(queries) {
    try {
        const results = await sqliteDB.transaction(queries);
        return results;
    } catch (error) {
        console.error('Database transaction error:', error);
        throw error;
    }
}

module.exports = {
    testConnection,
    close,
    query,
    transaction
};